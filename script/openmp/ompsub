#!/bin/sh
#
# ompsub -n np exe args

subname=ompsub
which_script=$HOME/local/etc/ompsubscript
source $HOME/local/etc/subbasement.sh

cat <<EOF > $SUBFILE
# HTCondor script generated by $subname
universe = vanilla
executable = $which_script
getenv = true
arguments = "$NP $hast $@"
request_cpus = $NP
notification = never

# Set max run time
periodic_remove = JobStatus == 2 && \
 ( (CurrentTime - EnteredCurrentStatus) + \
   RemoteWallClockTime - CumulativeSuspensionTime < $MAX_RUN_TIME )

EOF

write_reqs

cat <<EOF >> $SUBFILE

output = $BASENAME.o
error  = $BASENAME.e
log    = $BASENAME.l
queue
EOF

if [ -z "$hasd" ]; then
  condor_submit $SUBFILE
fi
