#!/bin/sh
#
# csub -n np exe args

subname=csub
which_script=$HOME/local/etc/csubscript
source $HOME/local/etc/subbasement.sh

cat <<EOF > $SUBFILE
# HTCondor script generated by $subname
universe = vanilla
executable = $which_script
getenv = true
arguments = "$hast $@"
notification = never

# Set max run time
periodic_remove = JobStatus == 2 && \
 ( (CurrentTime - EnteredCurrentStatus) + \
   RemoteWallClockTime - CumulativeSuspensionTime < $MAX_RUN_TIME )

EOF

write_reqs

for job in `seq 1 $NP` ; do
let jobid=job-1
cat <<EOF >> $SUBFILE

output = $BASENAME-o.$jobid
error  = $BASENAME-e.$jobid
log    = $BASENAME-l.$jobid
queue
EOF
done

if [ -z "$hasd" ]; then
  condor_submit $SUBFILE
fi
